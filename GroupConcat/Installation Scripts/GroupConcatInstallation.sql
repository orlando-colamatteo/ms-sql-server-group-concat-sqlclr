/*
GROUP_CONCAT string aggregate for SQL Server - https://github.com/orlando-colamatteo/ms-sql-server-group-concat-sqlclr
Copyright (C) 2011  Orlando Colamatteo

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or 
any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

See http://www.gnu.org/licenses/ for a copy of the GNU General Public 
License.
*/

/*
Installation script for GROUP_CONCAT functions. Tested in SSMS 2008R2.
*/
SET NOCOUNT ON ;
GO

-- !! MODIFY TO SUIT YOUR TEST ENVIRONMENT !!
USE GroupConcatTest
GO

-------------------------------------------------------------------------------------------------------------------------------
-- Turn advanced options on
EXEC sys.sp_configure @configname = 'show advanced options', @configvalue = 1 ;
GO
RECONFIGURE WITH OVERRIDE ;
GO
-- Enable CLR
EXEC sys.sp_configure @configname = 'clr enabled', @configvalue = 1 ;
GO
RECONFIGURE WITH OVERRIDE ;
GO
-------------------------------------------------------------------------------------------------------------------------------
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, QUOTED_IDENTIFIER ON;
SET CONCAT_NULL_YIELDS_NULL, NUMERIC_ROUNDABORT OFF;
GO
IF EXISTS (SELECT * FROM tempdb..sysobjects WHERE id=OBJECT_ID('tempdb..#tmpErrors')) DROP TABLE #tmpErrors
GO
CREATE TABLE #tmpErrors (Error int)
GO
SET XACT_ABORT ON
GO
SET TRANSACTION ISOLATION LEVEL READ COMMITTED
GO
BEGIN TRANSACTION
GO
-------------------------------------------------------------------------------------------------------------------
PRINT N'Creating [GroupConcat]...';
GO
CREATE ASSEMBLY [GroupConcat]
    AUTHORIZATION [dbo]
	FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C0103005BF68A5C0000000000000000E00022200B013000002000000008000000000000023E00000020000000400000000000100020000000020000040000000000000004000000000000000080000000020000ADD40000030040850000100000100000000010000010000000000000100000000000000000000000B03D00004F000000004000008C04000000000000000000000000000000000000006000000C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000081E0000002000000020000000020000000000000000000000000000200000602E727372630000008C040000004000000006000000220000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000002800000000000000000000000000004000004200000000000000000000000000000000E43D0000000000004800000002000500B82C00007810000009000000000000000000000000000000303D00008000000000000000000000000000000000000000000000000000000000000000000000003202730E00000A7D010000042A0000001330040047000000010000110F01280F00000A2D3D0F01281000000A0A027B01000004066F1100000A2C1A027B010000040B060C070807086F1200000A17586F1300000A2A027B0100000406176F1400000A2A001B3005008700000002000011037B010000046F1500000A0A2B5F1200281600000A0B1201281700000A0C027B01000004086F1100000A2C29027B010000040D0813040911040911046F1200000A037B01000004086F1200000A586F1300000A2B18027B0100000408037B01000004086F1200000A6F1400000A1200281800000A2D98DE0E1200FE160300001B6F1900000ADC2A000110000002000C006C78000E000000001B3003009B00000003000011027B010000043989000000027B010000046F1A00000A16317B731B00000A0A027B010000046F1500000A0B2B341201281600000A0C160D2B1E061202281700000A6F1C00000A260672010000706F1C00000A260917580D091202281D00000A32D81201281800000A2DC3DE0E1201FE160300001B6F1900000ADC06066F1E00000A1759176F1F00000A6F2000000A282100000A2A14282100000A2A000110000002002B00416C000E00000000133003003900000004000011036F2200000A0A0206732300000A7D01000004160B2B1B027B01000004036F2400000A036F2200000A6F1400000A0717580B0706175931DF2A0000001B3002005B0000000500001103027B010000046F1A00000A6F2500000A027B010000046F1500000A0A2B221200281600000A0B031201281700000A6F2600000A031201281D00000A6F2500000A1200281800000A2DD5DE0E1200FE160300001B6F1900000ADC2A000110000002001D002F4C000E000000001330020024000000060000110F01FE16130000016F2000000A0A027B0300000406282700000A2C0702067D030000042A5E02730E00000A7D02000004027E2800000A7D030000042A133004004F000000010000110F01280F00000A2D450F01281000000A0A027B02000004066F1100000A2C1B027B020000040B060C070807086F1200000A17586F1300000A2B0D027B0200000406176F1400000A020428070000062A001B300500A000000002000011027B03000004282900000A2C0C02037B030000047D03000004037B020000046F1500000A0A2B5F1200281600000A0B1201281700000A0C027B02000004086F1100000A2C29027B020000040D0813040911040911046F1200000A037B02000004086F1200000A586F1300000A2B18027B0200000408037B02000004086F1200000A6F1400000A1200281800000A2D98DE0E1200FE160300001B6F1900000ADC2A01100000020025006C91000E000000001B300300B300000003000011027B0200000439A1000000027B020000046F1A00000A163E90000000731B00000A0A027B020000046F1500000A0B2B351201281600000A0C160D2B1F061202281700000A6F1C00000A2606027B030000046F1C00000A260917580D091202281D00000A32D71201281800000A2DC2DE0E1201FE160300001B6F1900000ADC06066F1E00000A027B030000046F2A00000A59027B030000046F2A00000A6F1F00000A6F2000000A282100000A2A14282100000A2A000110000002002E004270000E00000000133003004500000004000011036F2200000A0A0206732300000A7D02000004160B2B1B027B02000004036F2400000A036F2200000A6F1400000A0717580B0706175931DF02036F2400000A7D030000042A0000001B300200670000000500001103027B020000046F1A00000A6F2500000A027B020000046F1500000A0A2B221200281600000A0B031201281700000A6F2600000A031201281D00000A6F2500000A1200281800000A2DD5DE0E1200FE160300001B6F1900000ADC03027B030000046F2600000A2A000110000002001D002F4C000E000000001330020024000000060000110F01FE16130000016F2000000A0A027B0500000406282700000A2C0702067D050000042AEA027B060000042D310F01282B00000A172E150F01282B00000A182E0B7205000070732C00000A7A020F01282B00000A282D00000A7D060000042A7A02730E00000A7D04000004027E2800000A7D0500000402167D060000042A00001330040056000000010000110F01280F00000A2D4C0F01281000000A0A027B04000004066F1100000A2C1B027B040000040B060C070807086F1200000A17586F1300000A2B0D027B0400000406176F1400000A0204280E0000060205280F0000062A00001B300500B400000002000011027B05000004282900000A2C0C02037B050000047D05000004027B060000042D0C02037B060000047D06000004037B040000046F1500000A0A2B5F1200281600000A0B1201281700000A0C027B04000004086F1100000A2C29027B040000040D0813040911040911046F1200000A037B04000004086F1200000A586F1300000A2B18027B0400000408037B04000004086F1200000A6F1400000A1200281800000A2D98DE0E1200FE160300001B6F1900000ADC2A01100000020039006CA5000E000000001B300300DA00000007000011027B0400000439C8000000027B040000046F1A00000A163EB7000000731B00000A0B027B06000004183313027B04000004731E000006732E00000A0A2B0C027B04000004732F00000A0A066F3000000A0C2B391202283100000A0D1613042B21071203281700000A6F1C00000A2607027B050000046F1C00000A2611041758130411041203281D00000A32D41202283200000A2DBEDE0E1202FE160600001B6F1900000ADC07076F1E00000A027B050000046F2A00000A59027B050000046F2A00000A6F1F00000A6F2000000A282100000A2A14282100000A2A000001100000020051004697000E00000000133003005100000004000011036F2200000A0A0206732300000A7D04000004160B2B1B027B04000004036F2400000A036F2200000A6F1400000A0717580B0706175931DF02036F2400000A7D0500000402036F3300000A7D060000042A0000001B300200730000000500001103027B040000046F1A00000A6F2500000A027B040000046F1500000A0A2B221200281600000A0B031201281700000A6F2600000A031201281D00000A6F2500000A1200281800000A2DD5DE0E1200FE160300001B6F1900000ADC03027B050000046F2600000A03027B060000046F3400000A2A000110000002001D002F4C000E00000000EA027B080000042D310F01282B00000A172E150F01282B00000A182E0B7205000070732C00000A7A020F01282B00000A282D00000A7D080000042A4E02730E00000A7D0700000402167D080000042A00133004004F000000010000110F01280F00000A2D450F01281000000A0A027B07000004066F1100000A2C1B027B070000040B060C070807086F1200000A17586F1300000A2B0D027B0700000406176F1400000A020428160000062A001B3005009B00000002000011027B080000042D0C02037B080000047D08000004037B070000046F1500000A0A2B5F1200281600000A0B1201281700000A0C027B07000004086F1100000A2C29027B070000040D0813040911040911046F1200000A037B07000004086F1200000A586F1300000A2B18027B0700000408037B07000004086F1200000A6F1400000A1200281800000A2D98DE0E1200FE160300001B6F1900000ADC2A0001100000020020006C8C000E000000001B300300C900000008000011027B0700000439B7000000027B070000046F1A00000A163EA6000000731B00000A0B027B08000004183313027B07000004731E000006732E00000A0A2B0C027B07000004732F00000A0A066F3000000A0C2B3C1202283100000A0D1203281700000A13041613052B1B0711046F1C00000A260772010000706F1C00000A2611051758130511051203281D00000A32DA1202283200000A2DBBDE0E1202FE160600001B6F1900000ADC07076F1E00000A1759176F1F00000A6F2000000A282100000A2A14282100000A2A0000000110000002005100499A000E00000000133003004500000004000011036F2200000A0A0206732300000A7D07000004160B2B1B027B07000004036F2400000A036F2200000A6F1400000A0717580B0706175931DF02036F3300000A7D080000042A0000001B300200670000000500001103027B070000046F1A00000A6F2500000A027B070000046F1500000A0A2B221200281600000A0B031201281700000A6F2600000A031201281D00000A6F2500000A1200281800000A2DD5DE0E1200FE160300001B6F1900000ADC03027B080000046F3400000A2A000110000002001D002F4C000E000000002204036F3500000A2A1E02283600000A2A00000042534A4201000100000000000C00000076322E302E35303732370000000005006C000000A4060000237E000010070000F404000023537472696E677300000000040C00006C00000023555300700C0000100000002347554944000000800C0000F803000023426C6F6200000000000000020000015717A2090900000000FA013300160000010000002200000006000000080000001E0000001E000000050000003600000019000000080000000300000004000000040000000600000001000000030000000000F4020100000000000600EE01050406006D02050406003701D3030F002504000006005F0128030600D10128030600B201280306005402280306000E02280306003902280306009701280306004B01E6030A005C04A4030A007601A4030600020121030A00BA02A40306003A00C5000A002702A4030A00D60234044700C203000006001700C50006006103A2040600540365000600970365000A00940234040E003400C5006B00C203000006006304210306000100C5000600F60021030600E202210306003A03210306009104210306002600C500000000004700000000000100010009211000A30050043D000100010009211000500050043D000200070009211000840050043D0004000E0009211000940050043D0007001600010010006F035004710009001D0001004904110201004904110201008D03E10001004904110201008D03E1000100BD0419020100490411020100BD041902502000000000860076040600010060200000000086001C011C020100B420000000008600F000220202005821000000008600270128020300102200000000E601E0002D020400582200000000E601310133020500D0220000000081087F031C020600002300000000860076040600070018230000000086001C01390207007423000000008600F000410209003024000000008600270128020A00002500000000E601E0002D020B00542500000000E601310133020C00D8250000000081087F031C020D000826000000008108B20447020E004326000000008600760406000F0064260000000086001C014D020F00C826000000008600F000570212009827000000008600270128021300902800000000E601E0002D021400F02800000000E6013101330215008029000000008108B20447021600BB29000000008600760406001700D0290000000086001C015D0217002C2A000000008600F00065021900E42A000000008600270128021A00CC2B00000000E601E0002D021B00202C00000000E601310133021C00A42C00000000E6010C016B021D00AD2C000000008618CD0306001F00000001005F00000001004E0300000000000000000100D10300000100AE0400000100AD02000001005F00000002007A00000001004E0300000000000000000100D10300000100AE0400000100AD0200000100AD02000001005F00000002007A00000003006F00000001004E0300000000000000000100D10300000100AE0400000100AD02000001005F00000002006F00000001004E0300000000000000000100D10300000100AE0400000100B00400000200F20402004100030041000400410005004100060006000900CD0301001100CD0306001900CD030A002900CD0310003100CD0310003900CD0310004100CD0310004900CD0310005100CD0310005900CD0310006100CD0315007100CD031A009100CD0306001400CD0306009900040338009900A3023C001400CC04400014000F034600140018034D001400E5004D001400BF036C001C007B047E002400C40490001C0099043800F1001401060014008704A700B100CD030600B100E900AB002400A302B100B100E902A700B100B302B600E100E0023C0099006A04BD00B9000D00A7001400CD030100B900CB023C00C10031010100C10031011000F900D804DB00F900EE04E100F900E604E400F900E902A700C900A302E9000101CD03100009019C02ED002C00CD0311012C00CD0324012C00BF03310134007B047E00340099043800B9008B02E900C10031014301F90044036101E100CD03060024006B00BF032E000B007B022E00130084022E001B00A3022E002300AC022E002B00BD022E0033002E032E003B002E032E004300AC022E004B0034032E0053002E032E005B002E03430063004C03630063004C0364006B00D203830063004C03A30063004C03E4006B00BF0304016B00E50344016B00D203E4016B00BF0304026B00E50364026B00D203E4026B00BF0344036B00D2032D0055009500C300C800D700F20048010300010004000200050004000000830371020000830371020000B60476020000B604760201000700030001000E00050001000F00070001001600090020002600770089000A013C010480000001000000641B357D010000006F01500400000200000000000000000000006601BC00000000000200000000000000000000006601B00000000000020000000000000000000000660121030000000000000049436F6D706172657260310052656164496E743332004B657956616C7565506169726032004944696374696F6E617279603200536F7274656444696374696F6E6172796032003C4D6F64756C653E0047524F55505F434F4E4341545F440056414C55450053797374656D2E494F00534F52545F4F524445520044454C494D495445520047524F55505F434F4E4341545F44530047524F55505F434F4E4341545F530047524F55505F434F4E4341540053797374656D2E44617461006D73636F726C69620053797374656D2E436F6C6C656374696F6E732E47656E6572696300526561640041646400417070656E64004D657267650049446973706F7361626C650056616C75655479706500436F6D7061726500446973706F736500416363756D756C617465005465726D696E6174650057726974650044656275676761626C6541747472696275746500436F6D56697369626C6541747472696275746500417373656D626C795469746C654174747269627574650053716C55736572446566696E656441676772656761746541747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C79436F6E66696775726174696F6E41747472696275746500417373656D626C794465736372697074696F6E41747472696275746500436F6D70696C6174696F6E52656C61786174696F6E7341747472696275746500417373656D626C7950726F647563744174747269627574650053716C466163657441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C79436F6D70616E794174747269627574650052756E74696D65436F6D7061746962696C6974794174747269627574650052656164427974650053716C4279746500546F42797465006765745F56616C75650076616C75650052656D6F7665004942696E61727953657269616C697A650052656164537472696E670053716C537472696E6700546F537472696E67006765745F4C656E6774680047726F7570436F6E6361742E646C6C006765745F49734E756C6C006765745F4974656D007365745F4974656D0053797374656D0053797374656D2E5265666C656374696F6E00457863657074696F6E00436F6D70617265546F0047726F75700042696E61727952656164657200537472696E674275696C6465720052657665727365436F6D7061726572007365745F44656C696D697465720064656C696D697465720042696E617279577269746572004D6963726F736F66742E53716C5365727665722E53657276657200476574456E756D657261746F72002E63746F720053797374656D2E446961676E6F73746963730053797374656D2E52756E74696D652E496E7465726F7053657276696365730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300446562756767696E674D6F6465730053797374656D2E446174612E53716C54797065730076616C7565730047726F7570436F6E63617400466F726D6174004F626A656374006F705F496D706C6963697400496E6974006765745F43757272656E74006765745F436F756E7400436F6E76657274004D6F76654E6578740053797374656D2E5465787400770078007365745F536F7274427900736F72744279006765745F4B657900436F6E7461696E734B6579006F705F496E657175616C6974790049734E756C6C4F72456D7074790000032C00006549006E00760061006C0069006400200053006F0072007400420079002000760061006C00750065003A00200075007300650020003100200066006F007200200041005300430020006F00720020003200200066006F007200200044004500530043002E0000006532458726DC8D4EAA932DE944092FD500042001010803200001052001011111042001010E042001010205200101113505151275010E06151245020E080A07030E151245020E080E032000020320000E052001021300062001130113000720020113001301160705151151020E08151155020E080E151245020E080E0A2000151151021300130106151151020E080A2000151155021300130106151155020E0804200013001107041259151151020E08151155020E08080320000805200112590E042000130106200212590808050001114D0E04070208080E0702151151020E08151155020E080307010E050002020E0E02060E040001020E032000050400010505170705151269020E08125915116D020E08151155020E080806151269020E08122002011512808902130013011512750113000C2001011512808902130013010A200015116D02130013010615116D020E080420010105180706151269020E08125915116D020E08151155020E080E08042001080E08B77A5C561934E08980A000240000048000009400000006020000002400005253413100040000010001001F566D44D4E8771A18ED249D4D95FD85718FFCF6CC54EBD74F2590F019529680A2378311EF66E3E5C1B93A280D1BC3137459A7630637432EBAD0E2D277AE55BDF113556D504AC4B7E86112BF2B1CDDCD95A7AD0061C4DFEFD15CD4831A49C339203C5C3D78F4C3E5B9AB0F763EF77FEF92651AABD03543ED33B586AD6DDB06AB0706151245020E0802060505200101114D052001011108042000114D05200101125D05200101126107200201114D114D05200101110C05200101116509200301114D114D116505200101111007200201114D1165052001011114052002080E0E042800114D04280011650801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F7773010801000200000000001001000B47726F7570436F6E63617400007001006B537472696E6720636F6E636174656E6174696F6E2061676772656761746520666F722053514C205365727665722E2044726F702D696E207265706C6163656D656E7420666F72206275696C742D696E204D7953514C2047524F55505F434F4E4341542066756E74696F6E2E000005010000000017010012436F7079726967687420C2A9202032303131000072010002000000050054080B4D61784279746553697A65FFFFFFFF5402124973496E76617269616E74546F4E756C6C73015402174973496E76617269616E74546F4475706C696361746573005402124973496E76617269616E74546F4F726465720154020D49734E756C6C4966456D7074790112010001005408074D617853697A65A00F000012010001005408074D617853697A65FFFFFFFF12010001005408074D617853697A65040000001F8F33F1F9A7CB2BAEE28CFC86B5946F0BEDC6BA4993B6F51173D6C97091FDF0626FFAE6D814D979F758AC06B7DAC29AB908330FF97A448F21CA7E359FEA58F9B3540BD7DAF9DAF06ABF42A1F1D8FBB38B075813462445CF8D71D2C05AF3051C29B1F1CA4EA63C7FFD7A2F5F8A5D3CFDB1A0A7382C7795F2E71DAFBBBD56A099D83D00000000000000000000F23D0000002000000000000000000000000000000000000000000000E43D0000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF2500200010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001000000018000080000000000000000000000000000001000100000030000080000000000000000000000000000001000000000048000000584000002E04000000000000000000002E0434000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE0000010000000100357D641B00000100357D641B3F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B0048E030000010053007400720069006E006700460069006C00650049006E0066006F0000006A0300000100300030003000300030003400620030000000F0006C00010043006F006D006D0065006E0074007300000053007400720069006E006700200063006F006E0063006100740065006E006100740069006F006E002000610067006700720065006700610074006500200066006F0072002000530051004C0020005300650072007600650072002E002000440072006F0070002D0069006E0020007200650070006C006100630065006D0065006E007400200066006F00720020006200750069006C0074002D0069006E0020004D007900530051004C002000470052004F00550050005F0043004F004E004300410054002000660075006E00740069006F006E002E00000022000100010043006F006D00700061006E0079004E0061006D006500000000000000000040000C000100460069006C0065004400650073006300720069007000740069006F006E0000000000470072006F007500700043006F006E0063006100740000003E000F000100460069006C006500560065007200730069006F006E000000000031002E0030002E0037003000310032002E00330032003000350033000000000040001000010049006E007400650072006E0061006C004E0061006D0065000000470072006F007500700043006F006E006300610074002E0064006C006C0000004800120001004C006500670061006C0043006F007000790072006900670068007400000043006F0070007900720069006700680074002000A90020002000320030003100310000002A00010001004C006500670061006C00540072006100640065006D00610072006B00730000000000000000004800100001004F0072006900670069006E0061006C00460069006C0065006E0061006D0065000000470072006F007500700043006F006E006300610074002E0064006C006C00000038000C000100500072006F0064007500630074004E0061006D00650000000000470072006F007500700043006F006E00630061007400000042000F000100500072006F006400750063007400560065007200730069006F006E00000031002E0030002E0037003000310032002E00330032003000350033000000000046000F00010041007300730065006D0062006C0079002000560065007200730069006F006E00000031002E0030002E0037003000310032002E00330032003000350033000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000C000000043E00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    WITH PERMISSION_SET = SAFE;
GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END
IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END
GO
EXEC sys.sp_addextendedproperty 
    @name = N'URL',
    @value = N'https://github.com/orlando-colamatteo/ms-sql-server-group-concat-sqlclr',
    @level0type = N'ASSEMBLY',
    @level0name = N'GroupConcat'
GO
-------------------------------------------------------------------------------------------------------------------
PRINT N'Creating [dbo].[GROUP_CONCAT_D]...';
GO
CREATE AGGREGATE [dbo].[GROUP_CONCAT_D](@VALUE NVARCHAR (4000), @DELIMITER NVARCHAR (4))
    RETURNS NVARCHAR (MAX)
    EXTERNAL NAME [GroupConcat].[GroupConcat.GROUP_CONCAT_D];
GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END
IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END
GO
-------------------------------------------------------------------------------------------------------------------
PRINT N'Creating [dbo].[GROUP_CONCAT_S]...';
GO
CREATE AGGREGATE [dbo].[GROUP_CONCAT_S](@VALUE NVARCHAR (4000), @SORT_ORDER TINYINT)
    RETURNS NVARCHAR (MAX)
    EXTERNAL NAME [GroupConcat].[GroupConcat.GROUP_CONCAT_S];
GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END
IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END
GO
-------------------------------------------------------------------------------------------------------------------
PRINT N'Creating [dbo].[GROUP_CONCAT_DS]...';
GO
CREATE AGGREGATE [dbo].[GROUP_CONCAT_DS](@VALUE NVARCHAR (4000), @DELIMITER NVARCHAR (4), @SORT_ORDER TINYINT)
    RETURNS NVARCHAR (MAX)
    EXTERNAL NAME [GroupConcat].[GroupConcat.GROUP_CONCAT_DS];
GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END
IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END
GO
-------------------------------------------------------------------------------------------------------------------
PRINT N'Creating [dbo].[GROUP_CONCAT]...';
GO
CREATE AGGREGATE [dbo].[GROUP_CONCAT](@VALUE NVARCHAR (4000))
    RETURNS NVARCHAR (MAX)
    EXTERNAL NAME [GroupConcat].[GroupConcat.GROUP_CONCAT];
GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END
IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END
GO
-------------------------------------------------------------------------------------------------------------------
IF EXISTS (SELECT * FROM #tmpErrors) ROLLBACK TRANSACTION
GO
IF @@TRANCOUNT>0 BEGIN
PRINT N'The transacted portion of the database update succeeded.'
COMMIT TRANSACTION
END
ELSE PRINT N'The transacted portion of the database update failed.'
GO
DROP TABLE #tmpErrors
-------------------------------------------------------------------------------------------------------------------
GO
